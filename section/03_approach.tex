\chapter{提案手法}　% 一般の人がわかるレベルのアルゴリズム解説
\label{chap:approach}
本研究での提案手法は麻雀の多人数を削除した、1 人麻雀を考え、その和了率の最大化を図る手法を提案する。

\section{１人麻雀について}
多人数ゲームでは状況によってプレイヤの行動の目的が違うといった難しさがある。この難しさを解消するために、相手を考慮しない１人麻雀プレイヤを考える。
この１人麻雀プレイヤのルールは、相手プレイヤを考えないため、相手プレイヤーに点数を支払う事による放銃や被ツモ失点などを考えない。また、相手プレイヤーによる捨て牌が存在しないので、鳴きや栄和を考えない。リーチについても、和了率の観点では不要なため、考えない。門前でツモを繰り返し行うだけのシンプルなシステムである。先行研究\cite{bakuuti}評価を合わせるため、ツモの回数は 27 回とした。

プレイ人数に着目した研究としてはポーカーを用いたもの \cite{poker},\cite{hurui} がある。これらの手法では 2 プレイヤでのゲームを強くしてから多人数に適応する方法がとられている。ポーカーは２ プレイヤであればナッシュ均衡戦略を用いることで世界チャンピオンに勝っているが、ポーカーは 2人から 10 人程度で参加可能なゲームであり人数が増える
と状態数が指数関数的に増大するためナッシュ均衡戦略の計算は難しい。そこで 2 人で行われたナッシュ均衡戦略を3 人限定で拡張する方法、プレイヤの行動を削減、抽象化することでより少ない人数の少ないゲームを想定する方法がとられた。

また、これらを元に麻雀においてもプレイヤの人数を削減してから多人数に適用する方法が取られている。
水上ら\cite{bakuuti}１人麻雀プレイ ヤの学習に牌譜との一致を目指した平均化パーセプトロンを用いた。麻雀の特徴量は非常に膨大なため、この方法が採用された。学習に使った教師信号は、麻 雀サイト天鳳 \cite{tenhou} において鳳凰卓でプレイすることができ るプレイヤの試合データである。鳳凰卓でプレ イできるのは全プレイヤの中でも上位 0.1％程度であり牌
譜の質は高いと考えられる。この研究では、１人麻雀プレイヤの和了率が平均プレイヤを上回り、鳳凰卓でプレイできるプレイヤの和了率に近いレベルになった。
しかし、１人麻雀プレイヤの学習を行う際に、４人麻雀の牌譜を使っていることで、４人麻雀独特の打ち方を排除できない問題や、上級者が認知できない最適解を求められない問題があった。

１人麻雀において和了率を最大化することに関しては、以下のような理由が述べられる。

4 人麻雀では平均順位の低い (つまり上手い) プレイヤほ ど、平均和了点が低くても和了率が高いことが統計で明ら かになっている\cite{kagaku}。上手いプレイヤの平均和了点が低くなる理由として手役を無理に狙った打ち方をしないためで
ある。また麻雀の点数の特性上、満貫以上は難易度の割に
は点数が高くないといったことが挙げられるため、比較的
点数の低い点数で゙多く和了することが効率が良い。他にも和了
すれば他プレイヤが和了することができないため、相手の
チャンスをつぶすといった意味でも和了率の高さは大事で
ある。

\section{探索空間を限定する手法の提案}
\subsection{１人麻雀プレイヤにおける和了率の数理的評価}

国士氏の研究により、ある手牌における聴牌までの平均消費順目は、それぞれの変化での平均消費巡目のそれぞれの変化する確率での単純な平均で与えられることがわかっている。[3]すなわち、元の成功率がp、手変わりする確率がq,r、手変わり後の成功率がQ,Rならば、

その手の向聴が進むまでの平均消費巡目は

$(p * 1/p ＋ q * 1/Q ＋ r * 1/R) / (p+q+r)　（２）$

と表される。

本論文ではこれを和了時までの式に拡張する。
まず、聴牌までの平均順目と聴牌後の和了までの平均順目の合計がすなわち全体の平均消費順目であることを証明する。
次に、それを合成した結果の数式がどうなるかを書く。

考察の結果このようになる。

$(p * 1/p ＋ q * 1/Q ＋ r * 1/R) / (p+q+r)　+ 和了期待順目　（３）$

また、(現在の平均テンパイ巡目)=(次巡の平均テンパイ巡目)+1　であることから、
各ノードが手替わり率とテンパイ率を値として持つ深さ1の木構造で記述できる。 
したがって、同様に、n手先の手替わりまで考えると深さnの木構造で記述することができる。
ｎを大きくすることにより、精度の高い和了率を近似することが可能となる。

図２

本研究では、この式(３)をそれぞれの牌姿に当てはめ、その計算結果が高くなるようなノードを探索する。
これにより、従来の手法では何回も同じ牌姿の変化をシミュレートしなければいけない問題があったが、（３）式の評価によってその多くが削減できる。
したがって、この方法によって精度が高くなることが期待される。

\subsection{二向聴以下の牌姿に対してモンテカルロ法を適用する}

麻雀において、和了までの手順の中では、シャンテン数が小さい時点での選択が成績に影響を与えやすいことがわかっている\cite{gendai}
したがって、成績向上のためには和了系に近い部分において戦略を改善することが成績に影響を与えやすい事がわかる。

また、モンテカルロ法の問題点は、前述したとおり麻雀に適用すると探索空間が大きくなりすぎることが問題であった。しかしこれを和了系に近い部分に適用することで、
探索空間を小さく削減することができるため、適用することができるようになる。
本研究の手法である与えられた牌姿における和了率の近似式（３）を適用する際にも、シャンテン数が大きすぎる場合については正確に見積もることが難しいため、このような限定的な部分への適用が重要である。

本論文では二向聴以上の部分にこのモンテカルロ法を適用することで、従来の問題点を解決する。
